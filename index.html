<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Quiz Generator</title>
</head>
<body>
  <h1>AI Quiz Generator</h1>  
  <form id="quiz-form">
    <input id="topic" placeholder="Enter a topic" />
    <button type="submit" id="generate">Generate Quiz</button>
  </form>
  
  <!-- Container where the quiz questions and results will be dynamically inserted -->
  <div id="quiz"></div>

  <script>
    // Get references to DOM elements we'll need throughout the app
    const topicInput = document.getElementById("topic");
    const quizContainer = document.getElementById("quiz");

    // Listen for form submission (triggered by button click or Enter key)
    document.getElementById("quiz-form").addEventListener("submit", async (e) => {
      e.preventDefault(); // Stop the form from reloading the page
      
      // Validate that user entered a topic
      const topic = topicInput.value.trim();
      if (!topic) {
        console.log("No topic entered, please try again.");
        return alert("Enter a topic in the field to generate a quiz.");
      };

      // Show loading message while waiting for AI responses
      quizContainer.innerHTML = "Generating quiz, please wait...";

      // Send POST request to our server with the topic
      const res = await fetch("/api/quiz", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic })
      });

      // Parse the JSON response from the server
      const data = await res.json();

      // Handle any errors from the API
      if (data.error) {
        quizContainer.innerHTML = "Error: " + data.error;
        return;
      }

      // Clear loading message and build the quiz UI
      quizContainer.innerHTML = "";
      
      // Loop through each question and create HTML elements
      data.questions.forEach((q, i) => {
        const div = document.createElement("div");
        // Display question number and text, then map over options to create radio buttons
        // Each question's radio buttons share the same name (q0, q1, etc.) so only one can be selected
        div.innerHTML = `<strong>${i + 1}. ${q.question}</strong><br>
          ${q.options.map(opt => `<label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label><br>`).join("")}`;
        quizContainer.appendChild(div);
      });
      
      // Create and add submit button after all questions are displayed
      const button = document.createElement("button");
      button.textContent = "Submit Quiz";
      quizContainer.appendChild(button);

      // Handle quiz submission and grading
      button.addEventListener("click", () => {
        // VALIDATION: Check that all 5 questions have been answered
        for (let i = 0; i < 5; i++) {
            const selectedAnswer = document.querySelector('input[name="q' + i + '"]:checked');
            if (!selectedAnswer) {
            alert("Please answer all questions before submitting!");
            return;  // Exit early if any question is unanswered
            }
        }

        // GRADING: Loop through questions and compare user answers to correct answers
        let score = 0;
        for (let i = 0; i < 5; i++) {
            const selectedAnswer = document.querySelector('input[name="q' + i + '"]:checked');
            
            // Get the correct answer letter (A, B, C, or D) from AI response
            const correctLetter = data.questions[i].answer;
            
            // Convert letter to array index: A=0, B=1, C=2, D=3
            // charCodeAt(0) gets ASCII value: A=65, B=66, etc.
            const correctIndex = correctLetter.charCodeAt(0) - 65;
            
            // Use index to get the full text of the correct answer
            const correctAnswerText = data.questions[i].options[correctIndex];
            
            // Compare first character of selected answer to correct answer letter
            // (selectedAnswer.value contains full text, so we grab just first char)
            if (data.questions[i].answer === selectedAnswer.value[0]) {
                const div = document.createElement("div");
                div.innerHTML = `You answered question ${i + 1} correctly, ${correctAnswerText}!<br>`
                quizContainer.appendChild(div);
                score++; // Increment score for correct answer
            } else {
                const div = document.createElement("div");
                div.innerHTML = `You answered question ${i + 1} incorrectly... The correct answer was ${correctAnswerText}.<br>`
                quizContainer.appendChild(div);     
            }
        }
        
        // Display final score after all questions are checked
        const div = document.createElement("div");
        div.innerHTML = `<strong>You answered ${score}/5 questions correctly!</strong><br>`
        quizContainer.appendChild(div);
      });
    });
  </script>
</body>
</html>